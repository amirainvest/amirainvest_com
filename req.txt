# ======================= Start First Request  =======================
# ====================================================================
26 Jan 2022 03:51:23,974 [INFO] (rapid) extensionsDisabledByLayer(/opt/disable-extensions-jwigqn8j) -> stat /opt/disable-extensions-jwigqn8j: no such file or directory
26 Jan 2022 03:51:23,974 [WARNING] (rapid) Cannot list external agents error=open /opt/extensions: no such file or directory
START RequestId: d3f3b3f4-1515-4331-a881-5a692a349477 Version: $LATEST
HI!!!  Tsk_f46bd51044d94991b8db2aa19e0fa3d1
2022-01-26 03:51:24,291 - INFO - MainProcess:MainThread - decorators.py:wrapper_events:69 - Starting market_data_amirainvest_com.repository.get_securities_collect_true
2022-01-26 03:51:24,297 INFO sqlalchemy.engine.Engine select pg_catalog.version()
2022-01-26 03:51:24,297 INFO sqlalchemy.engine.Engine [raw sql] ()
2022-01-26 03:51:24,298 INFO sqlalchemy.engine.Engine select current_schema()
2022-01-26 03:51:24,298 INFO sqlalchemy.engine.Engine [raw sql] ()
2022-01-26 03:51:24,299 INFO sqlalchemy.engine.Engine show standard_conforming_strings
2022-01-26 03:51:24,299 INFO sqlalchemy.engine.Engine [raw sql] ()
2022-01-26 03:51:24,300 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2022-01-26 03:51:24,325 INFO sqlalchemy.engine.Engine SELECT securities.id, securities.collect, securities.name, securities.ticker_symbol, securities.exchange, securities.description, securities.website, securities.industry, securities.ceo, securities.issue_type, securities.sector, securities.primary_sic_code, securities.employee_count, securities.address, securities.phone, securities.open_price, securities.close_price, securities.type, securities.currency, securities.last_updated, securities.created_at
FROM securities
WHERE securities.collect = true
2022-01-26 03:51:24,325 INFO sqlalchemy.engine.Engine [generated in 0.00013s] ()
2022-01-26 03:51:24,327 INFO sqlalchemy.engine.Engine COMMIT
2022-01-26 03:51:24,327 - INFO - MainProcess:MainThread - decorators.py:wrapper_events:91 - Finished market_data_amirainvest_com.repository.get_securities_collect_true
AAPL
END RequestId: d3f3b3f4-1515-4331-a881-5a692a349477
REPORT RequestId: d3f3b3f4-1515-4331-a881-5a692a349477	Init Duration: 0.37 ms	Duration: 354.40 ms	Billed Duration: 355 ms	Memory Size: 3008 MB	Max Memory Used: 3008 MB
# ======================= End First Request  =======================
# ==================================================================

# ======================= Start Second Request  =======================
# =====================================================================
START RequestId: 82a41fa3-0e5b-411b-b74f-00b6014806ee Version: $LATEST
HI!!!  Tsk_f46bd51044d94991b8db2aa19e0fa3d1
2022-01-26 03:52:19,192 - INFO - MainProcess:MainThread - decorators.py:wrapper_events:69 - Starting market_data_amirainvest_com.repository.get_securities_collect_true
2022-01-26 03:52:19,192 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2022-01-26 03:52:19,193 INFO sqlalchemy.engine.Engine SELECT securities.id, securities.collect, securities.name, securities.ticker_symbol, securities.exchange, securities.description, securities.website, securities.industry, securities.ceo, securities.issue_type, securities.sector, securities.primary_sic_code, securities.employee_count, securities.address, securities.phone, securities.open_price, securities.close_price, securities.type, securities.currency, securities.last_updated, securities.created_at
FROM securities
WHERE securities.collect = true
2022-01-26 03:52:19,193 INFO sqlalchemy.engine.Engine [cached since 54.87s ago] ()
2022-01-26 03:52:19,193 INFO sqlalchemy.engine.Engine ROLLBACK
2022-01-26 03:52:19,194 - ERROR - MainProcess:MainThread - decorators.py:wrapper_events:94 - Task <Task pending name='Task-5' coro=<run() running at /function/src/market_data_amirainvest_com/lib/market_data_amirainvest_com/lambdas/realtime_updates/app.py:46> cb=[_run_until_complete_cb() at /usr/local/lib/python3.9/asyncio/base_events.py:184]> got Future <Future pending cb=[Protocol._on_waiter_completed()]> attached to a different loop
Traceback (most recent call last):
  File "/function/src/common_amirainvest_com/lib/common_amirainvest_com/utils/decorators.py", line 82, in wrapper_events
    func_return = await _session_work(session, args, kwargs)
  File "/function/src/common_amirainvest_com/lib/common_amirainvest_com/utils/decorators.py", line 63, in _session_work
    func_return = await func(*args, **kwargs)
  File "/function/src/market_data_amirainvest_com/lib/market_data_amirainvest_com/repository.py", line 144, in get_securities_collect_true
    response = await session.execute(select(Securities).where(Securities.collect == True))  # noqa: E712
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py", line 211, in execute
    return await greenlet_spawn(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 134, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/session.py", line 1692, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2030, in _handle_dbapi_exception
    util.raise_(exc_info[1], with_traceback=exc_info[2])
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 460, in execute
    self._adapt_connection.await_(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 389, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 697, in _start_transaction
    self._handle_exception(error)
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 665, in _handle_exception
    raise error
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 695, in _start_transaction
    await self._transaction.start()
  File "/usr/local/lib/python3.9/site-packages/asyncpg/transaction.py", line 138, in start
    await self._connection.execute(query)
  File "/usr/local/lib/python3.9/site-packages/asyncpg/connection.py", line 318, in execute
    return await self._protocol.query(query, timeout)
  File "asyncpg/protocol/protocol.pyx", line 338, in query
RuntimeError: Task <Task pending name='Task-5' coro=<run() running at /function/src/market_data_amirainvest_com/lib/market_data_amirainvest_com/lambdas/realtime_updates/app.py:46> cb=[_run_until_complete_cb() at /usr/local/lib/python3.9/asyncio/base_events.py:184]> got Future <Future pending cb=[Protocol._on_waiter_completed()]> attached to a different loop
2022-01-26 03:52:19,196 - ERROR - MainProcess:MainThread - app.py:run:57 - Task <Task pending name='Task-5' coro=<run() running at /function/src/market_data_amirainvest_com/lib/market_data_amirainvest_com/lambdas/realtime_updates/app.py:46> cb=[_run_until_complete_cb() at /usr/local/lib/python3.9/asyncio/base_events.py:184]> got Future <Future pending cb=[Protocol._on_waiter_completed()]> attached to a different loop
Traceback (most recent call last):
  File "/function/src/market_data_amirainvest_com/lib/market_data_amirainvest_com/lambdas/realtime_updates/app.py", line 46, in run
    securities = await get_securities_collect_true()
  File "/function/src/common_amirainvest_com/lib/common_amirainvest_com/utils/decorators.py", line 82, in wrapper_events
    func_return = await _session_work(session, args, kwargs)
  File "/function/src/common_amirainvest_com/lib/common_amirainvest_com/utils/decorators.py", line 63, in _session_work
    func_return = await func(*args, **kwargs)
  File "/function/src/market_data_amirainvest_com/lib/market_data_amirainvest_com/repository.py", line 144, in get_securities_collect_true
    response = await session.execute(select(Securities).where(Securities.collect == True))  # noqa: E712
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py", line 211, in execute
    return await greenlet_spawn(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 134, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/session.py", line 1692, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2030, in _handle_dbapi_exception
    util.raise_(exc_info[1], with_traceback=exc_info[2])
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 460, in execute
    self._adapt_connection.await_(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 389, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 697, in _start_transaction
    self._handle_exception(error)
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 665, in _handle_exception
    raise error
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 695, in _start_transaction
    await self._transaction.start()
  File "/usr/local/lib/python3.9/site-packages/asyncpg/transaction.py", line 138, in start
    await self._connection.execute(query)
  File "/usr/local/lib/python3.9/site-packages/asyncpg/connection.py", line 318, in execute
    return await self._protocol.query(query, timeout)
  File "asyncpg/protocol/protocol.pyx", line 338, in query
RuntimeError: Task <Task pending name='Task-5' coro=<run() running at /function/src/market_data_amirainvest_com/lib/market_data_amirainvest_com/lambdas/realtime_updates/app.py:46> cb=[_run_until_complete_cb() at /usr/local/lib/python3.9/asyncio/base_events.py:184]> got Future <Future pending cb=[Protocol._on_waiter_completed()]> attached to a different loop
[ERROR] RuntimeError: Task <Task pending name='Task-5' coro=<run() running at /function/src/market_data_amirainvest_com/lib/market_data_amirainvest_com/lambdas/realtime_updates/app.py:46> cb=[_run_until_c  File "asyncpg/protocol/protocol.pyx", line 338, in querynection.py", line 318, in executeline 695, in _start_transactiontes_collect_trueached to a different loop
END RequestId: 82a41fa3-0e5b-411b-b74f-00b6014806ee
REPORT RequestId: 82a41fa3-0e5b-411b-b74f-00b6014806ee	Duration: 8.91 ms	Billed Duration: 9 ms	Memory Size: 3008 MB	Max Memory Used: 3008 MB
# ======================= End Second Request  =======================
# ===================================================================
